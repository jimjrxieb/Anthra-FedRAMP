# Runtime policy mapping — Falco alerts → Iron Legion ranks
# NIST Controls: IR-4 (Incident Handling), CA-7 (Continuous Monitoring)
#
# This file maps Falco rule priorities to Iron Legion response ranks.
# jsa-infrasec uses this to determine automation level for each alert.

version: "1.0.0"
client: "NovaSec Cloud"
baseline: "FedRAMP Moderate"

# Alert → Rank → Response mapping
alert_mappings:
  - rule: "NovaSec Shell Spawned in Container"
    iron_legion_rank: C
    nist_controls: [SI-4, IR-4]
    response:
      action: isolate_pod
      approval: jade  # JADE must approve C-rank
      timeout_seconds: 300
      escalation: B   # If JADE doesn't respond in 5min, escalate to human

  - rule: "NovaSec Crypto Mining Process"
    iron_legion_rank: C
    nist_controls: [SI-4, IR-4]
    response:
      action: kill_pod
      approval: jade
      timeout_seconds: 60
      escalation: B
      forensics: true  # Capture logs before kill

  - rule: "NovaSec Sensitive File Access"
    iron_legion_rank: D
    nist_controls: [SI-4, AU-2]
    response:
      action: log_and_alert
      approval: auto  # D-rank = auto with logging
      timeout_seconds: 0
      escalation: C

  - rule: "NovaSec Privilege Escalation Attempt"
    iron_legion_rank: C
    nist_controls: [AC-6, SI-4]
    response:
      action: isolate_pod
      approval: jade
      timeout_seconds: 120
      escalation: B
      forensics: true

  - rule: "NovaSec Cross-Tenant Network Access"
    iron_legion_rank: D
    nist_controls: [SC-7, SI-4]
    response:
      action: block_network
      approval: auto
      timeout_seconds: 0
      escalation: C

  - rule: "NovaSec Unexpected Outbound Connection"
    iron_legion_rank: D
    nist_controls: [SC-7, SI-4]
    response:
      action: log_and_alert
      approval: auto
      timeout_seconds: 0
      escalation: C

# Default mapping for unrecognized Falco alerts
default_mapping:
  iron_legion_rank: D
  response:
    action: log_and_alert
    approval: auto
    timeout_seconds: 0
    escalation: C

# Response actions reference
actions:
  log_and_alert:
    description: "Log finding and send alert to monitoring"
    rank_required: E
  block_network:
    description: "Apply NetworkPolicy to block suspicious traffic"
    rank_required: D
  isolate_pod:
    description: "Cordon pod, apply deny-all NetworkPolicy"
    rank_required: C
  kill_pod:
    description: "Terminate pod after forensic capture"
    rank_required: C
  quarantine_namespace:
    description: "Isolate entire namespace — blast radius containment"
    rank_required: B
