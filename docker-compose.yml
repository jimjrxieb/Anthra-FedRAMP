# Anthra Security Platform â€” Local Development Stack
#
# Quick start: docker compose up -d
#
# Services:
# - API:        http://localhost:8080
# - UI:         http://localhost:3000
# - Log Ingest: http://localhost:9090
# - Database:   localhost:5432

services:
  db:
    image: postgres:15
    container_name: anthra-db
    environment:
      POSTGRES_DB: anthra
      POSTGRES_USER: anthra
      # SECURITY: Secret removed - set POSTGRES_PASSWORD via environment variable or secrets manager
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data
      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql
    # Missing: resource limits, read-only filesystem, security options

  api:
    build: ./api
    container_name: anthra-api
    ports:
      - "8080:8080"
    environment:
      DB_HOST: db
      DB_PORT: "5432"
      DB_NAME: anthra
      DB_USER: anthra
      # SECURITY: Secret removed - set DB_PASSWORD via environment variable or secrets manager
    depends_on:
      - db
    # Missing: resource limits, healthchecks, security options, TLS

  ui:
    build: ./ui
    container_name: anthra-ui
    ports:
      - "3000:80"
    depends_on:
      - api
    # Missing: resource limits, healthchecks, HTTPS

  log-ingest:
    build: ./services
    container_name: anthra-log-ingest
    ports:
      - "9090:9090"
    environment:
      DB_HOST: db
      DB_PORT: "5432"
      DB_NAME: anthra
      DB_USER: anthra
      # SECURITY: Secret removed - set DB_PASSWORD via environment variable or secrets manager
    depends_on:
      - db
    # Missing: resource limits, healthchecks, TLS, rate limiting

volumes:
  pgdata:
    name: anthra_pgdata

# =============================================================================
# Security gaps (FedRAMP remediation needed):
# - CWE-798/522: Credentials exposed in environment variables
# - Missing resource limits (memory, CPU)
# - No healthchecks configured
# - Services run as root (no user specified)
# - No network segmentation
# - All ports exposed to host
# - No TLS/mTLS between services
# - No secrets management integration
# =============================================================================
